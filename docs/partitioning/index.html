<!DOCTYPE html><html><head><title>Parquet4s: Partitioning</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Marcin Jakubowski" /><meta name="description" content="Read and write Parquet files using Scala" /><meta name="og:image" content="/parquet4s/img/poster.png" /><meta name="image" property="og:image" content="/parquet4s/img/poster.png" /><meta name="og:title" content="Parquet4s: Partitioning" /><meta name="title" property="og:title" content="Parquet4s: Partitioning" /><meta name="og:site_name" content="Parquet4s" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Read and write Parquet files using Scala" /><link rel="icon" type="image/png" href="/parquet4s/img/favicon.png" /><meta name="twitter:title" content="Parquet4s: Partitioning" /><meta name="twitter:image" content="/parquet4s/img/poster.png" /><meta name="twitter:description" content="Read and write Parquet files using Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/parquet4s/img/favicon-16x16.png" /><link rel="icon" type="image/png" sizes="32x32" href="/parquet4s/img/favicon-32x32.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/parquet4s/highlight/styles/vs.css" /><link rel="stylesheet" href="/parquet4s/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/parquet4s/" class="brand"><div class="brand-wrapper"></div><span>Parquet4s</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/parquet4s/docs" title="Introduction" class="">Introduction</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/quick_start" title="Quick Start" class="">Quick Start</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/akka" title="Integration with Akka Streams" class="">Integration with Akka Streams</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/fs2" title="Integration with FS2" class="">Integration with FS2</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/storage_types" title="Supported storage types" class="">Supported storage types</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/records_and_schema" title="Records, types and schema" class="">Records, types and schema</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/projection" title="Projection" class="">Projection</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/filtering" title="Filtering" class="">Filtering</a></div> <div class="sidebar-nav-item active "><a href="/parquet4s/docs/partitioning" title="Partitioning" class="active">Partitioning</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/statistics" title="Statistics" class="">Statistics</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/examples" title="Examples" class="">Examples</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/migration" title="Migration from 1.x" class="">Migration from 1.x</a></div> <div class="sidebar-nav-item  "><a href="/parquet4s/docs/experimental" title="(Experimental) Joins and Concat" class="">(Experimental) Joins and Concat</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/mjakubowski84/parquet4s" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/mjakubowski84/parquet4s" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="mjakubowski84" data-github-repo="parquet4s"><div class="content-wrapper"><section><h1 id="partitioning">Partitioning</h1>

<p>Parquet4s supports both reading partitions and partitioning data during writing. This feature is available <strong>only</strong> in Akka and FS2 modules.</p>

<p>Reading partitions is handled by default by <code class="language-plaintext highlighter-rouge">fromParquet</code> function. Before data is read Parquet4s scans the directory and resolves partition fields and values. After reading each record is enriched according to partition directory tree the file resides in.</p>

<p>Writing partitioned data is available in <code class="language-plaintext highlighter-rouge">viaParquet</code>. You can specify by which columns data shall be partitioned and Parquet4s will automatically create proper directory structure and it will remove the fields from the written records (so that there is no data redundancy).</p>

<p><strong>Take note</strong>: partition field must be a String.</p>

<p>In Akka:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">akka.NotUsed</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.scaladsl.</span><span class="o">{</span><span class="nc">Sink</span><span class="o">,</span> <span class="nc">Source</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.github.mjakubowski84.parquet4s.</span><span class="o">{</span><span class="nc">Col</span><span class="o">,</span> <span class="nc">ParquetStreams</span><span class="o">,</span> <span class="nc">Path</span><span class="o">}</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="nv">actorSystem</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">PartitionDate</span><span class="o">(</span><span class="n">year</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">month</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">day</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">date</span><span class="k">:</span> <span class="kt">PartitionDate</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">users</span><span class="k">:</span> <span class="kt">Source</span><span class="o">[</span><span class="kt">User</span>, <span class="kt">NotUsed</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
<span class="k">val</span> <span class="nv">path</span> <span class="k">=</span> <span class="nc">Path</span><span class="o">(</span><span class="s">"path/to/user/directory"</span><span class="o">)</span>

<span class="c1">// writing partitioned data</span>
<span class="nv">users</span><span class="o">.</span><span class="py">via</span><span class="o">(</span>
  <span class="nc">ParquetStreams</span>
    <span class="o">.</span><span class="py">viaParquet</span>
    <span class="o">.</span><span class="py">of</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
    <span class="o">.</span><span class="py">partitionBy</span><span class="o">(</span><span class="nc">Col</span><span class="o">(</span><span class="s">"date.year"</span><span class="o">),</span> <span class="nc">Col</span><span class="o">(</span><span class="s">"date.month"</span><span class="o">),</span> <span class="nc">Col</span><span class="o">(</span><span class="s">"date.day"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
<span class="o">).</span><span class="py">runWith</span><span class="o">(</span><span class="nv">Sink</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="n">user</span> <span class="k">=&gt;</span> <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Just wrote $user"</span><span class="o">)))</span>

<span class="c1">// reading partitioned data</span>
<span class="nc">ParquetStreams</span>
  <span class="o">.</span><span class="py">fromParquet</span>
  <span class="o">.</span><span class="py">as</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="o">.</span><span class="py">read</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
  <span class="o">.</span><span class="py">runWith</span><span class="o">(</span><span class="nv">Sink</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="n">user</span> <span class="k">=&gt;</span> <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Just read $user"</span><span class="o">)))</span>
</code></pre></div></div>

<p>In FS2:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.effect.</span><span class="o">{</span><span class="nc">IO</span><span class="o">,</span> <span class="nc">IOApp</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.github.mjakubowski84.parquet4s.parquet.</span><span class="o">{</span><span class="n">fromParquet</span><span class="o">,</span> <span class="n">viaParquet</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.github.mjakubowski84.parquet4s.</span><span class="o">{</span><span class="nc">Col</span><span class="o">,</span> <span class="nc">Path</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">fs2.Stream</span>

<span class="k">object</span> <span class="nc">Example</span> <span class="k">extends</span> <span class="nv">IOApp</span><span class="o">.</span><span class="py">Simple</span> <span class="o">{</span>

  <span class="k">case</span> <span class="k">class</span> <span class="nc">PartitionDate</span><span class="o">(</span><span class="n">year</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">month</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">day</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">date</span><span class="k">:</span> <span class="kt">PartitionDate</span><span class="o">)</span>

  <span class="k">val</span> <span class="nv">users</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
  <span class="k">val</span> <span class="nv">path</span> <span class="k">=</span> <span class="nc">Path</span><span class="o">(</span><span class="s">"path/to/user/directory"</span><span class="o">)</span>
  
  <span class="k">val</span> <span class="nv">writePipe</span> <span class="k">=</span>
    <span class="n">viaParquet</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
      <span class="o">.</span><span class="py">of</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
      <span class="o">.</span><span class="py">partitionBy</span><span class="o">(</span><span class="nc">Col</span><span class="o">(</span><span class="s">"date.year"</span><span class="o">),</span> <span class="nc">Col</span><span class="o">(</span><span class="s">"date.month"</span><span class="o">),</span> <span class="nc">Col</span><span class="o">(</span><span class="s">"date.day"</span><span class="o">))</span>
      <span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
  
  <span class="k">val</span> <span class="nv">readStream</span> <span class="k">=</span>
    <span class="n">fromParquet</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
      <span class="o">.</span><span class="py">as</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
      <span class="o">.</span><span class="py">read</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
      <span class="o">.</span><span class="py">printlns</span>

  <span class="k">def</span> <span class="nf">run</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>  
    <span class="n">users</span>
      <span class="o">.</span><span class="py">through</span><span class="o">(</span><span class="n">writePipe</span><span class="o">)</span>
      <span class="o">.</span><span class="py">append</span><span class="o">(</span><span class="n">readStream</span><span class="o">)</span>
      <span class="o">.</span><span class="py">compile</span>
      <span class="o">.</span><span class="py">drain</span>
  
<span class="o">}</span>
</code></pre></div></div>
</section></div></div></div></div><script src="/parquet4s/highlight/highlight.pack.js"></script><script src="/parquet4s/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/parquet4s/js/search.js"></script><script src="/parquet4s/js/docs.js"></script></body></html>